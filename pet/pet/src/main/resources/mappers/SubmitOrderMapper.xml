<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.diamondboss.order.repository.SubmitOrderMapper" >

	<!-- 根据宠物编号查询预约日期  -->
	<select id="queryOrderByUser"
		parameterType="java.util.Map"
		resultType="java.lang.String">
		SELECT
		    order_time
		FROM
		    parter_order
		WHERE
		    pet_id = #{petId}
		    AND order_time &gt;= #{today}
		    AND effective = '1'
	</select>

	<!-- 查询订单  -->
	<select id="queryPartnerOrder"
		resultType="java.lang.Integer">
		SELECT
		    COUNT(1)
		FROM
		    parter_order
		WHERE
		    parter_id =  #{parterId}
		AND order_time = #{orderTime}
		AND effective = '1'
	</select>

	<!-- 插入订单  -->
	<insert id="insertPartnerOrder" parameterType="java.util.Map">
		INSERT INTO  #{tableName}
		(id, receive_time, return_time, pet_name, sex, age,
		phone, user_name, remark, user_id, partenr_id, order_date,
		order_status, amt, effective, create_time, update_time)
		VALUES
		(#{id,jdbcType=BIGINT},#{receiveTime}, #{returnTime}, #{petName}, #{sex}, #{age},
		#{phone}, #{userName}, #{remark},#{userId},#{partenrId}, #{orderDate},
		#{orderDate}, #{orderStatus},#{amt}, '1', #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP});
	</insert>

	<!-- 更新订单  -->
	<update id="updatePartnerOrder">
		UPDATE
		    #{tableName}
		SET
		    effective = #{effective} 
		WHERE
		   user_id = #{userId}
		   AND partenr_id = #{partnerId}
		   AND order_date = #{orderDate}
		   AND order_status = #{orderStatus}
	</update>

	<select id="queryCountsByPartnerAndDate" parameterType="map"
			resultType="Integer">
		SELECT COUNT(1)
		FROM #{tableName}
		WHERE
		parter_id = #{partnerId}
		AND order_date = #{currentDate}
		AND effctive = '1'
	</select>

</mapper>